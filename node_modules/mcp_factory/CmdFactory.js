var ctrl = require("mcp_control");
var config = require("mcp_config");
var adminCtl = ctrl.adminCtl;
var cTradeCrl = ctrl.cTradeCtl;
var printCtl = ctrl.printCtl;
var cQueryCtl = ctrl.cQueryCtl;
var newPrintCtl = ctrl.newPrintCtl;
var ec = config.ec;

var CmdFactory = function(){};

CmdFactory.prototype.handle = function(headNode, bodyStr, cb)
{
    if(headNode == undefined){
        cb(ec.E0006);
        return;
    }
    var cmdGroup = headNode.cmd.match(/^([A-Z]+)([0-9]{1,})$/);

    if(cmdGroup[1] == "AD")
    {
        adminCtl.handle(headNode, bodyStr, cb);
    }
    else if(cmdGroup[1] == "CT")
    {
        cTradeCrl.handle(headNode, bodyStr, cb);
    }
    else if(cmdGroup[1] == "CQ")
    {
        cQueryCtl.handle(headNode, bodyStr, cb);
    }
    else if(cmdGroup[1] == "P")
    {
        printCtl.handle(headNode, bodyStr, cb);
    }
    else
    {
        cb(ec.E9000);
    }
};

CmdFactory.prototype.handleNew = function(request, data, cb){
    if(request == "1"){
        //出票请求
        newPrintCtl.sendTicket(data, cb);
    }else if (request == "2"){
        newPrintCtl.reciveTicket(data, cb);
        //推送出票结果
    }else if (request == "3"){
        newPrintCtl.prizeTicket(data, cb);
        //兑奖发送请求
    }else if (request == "4"){
        newPrintCtl.recivePrizeTicket(data, cb);
        //兑奖中奖返回结果
    }else{
        cb({code:99999,message:"没有找到该接口"});
    }
}

var cmdFactory = new CmdFactory();
module.exports = cmdFactory;